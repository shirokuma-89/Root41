# Root41コーディング規則

## この規則の目的

本ガイドの目的は、合理的で見やすいプログラムを書くために定められたものです。

動作の良いプログラムでも読み手にやさしくないプログラムはよくありません。

逆に、読み手にやさしくても、動かないプログラムはよくありません。

このガイドは、プログラムを読みやすくすると同時に、

バグの発生を防ぐ目的にあります。

そのため、このガイドによってプログラム開発が妨げられるようなことがあれば、

このガイドは改定するべきです。

## インクルード

ヘッダーファイルやライブラリのインクルードは、

メインファイルの一番先頭に記述すべきです。

これは、読み込まれたヘッダーファイルを明確にする目的にあります。

インクルードガードはライブラリのインクルードに限り必要ありません。

## インライン関数

インライン関数は10行以下の関数でのみ使用することができます。

理由として、大きな関数をインライン化してしまうと、

コードサイズが大きくなってしまうことが挙げられます。

また、プログラムの低速化にもつながってしまう可能性があるためです。

## 変数・関数

### 宣言

変数・関数はですべてクラスで定義する必要があります。

（ライブラリ、void setup(){}、void loop(){}は例外とします。）

これは、何の変数・関数かを明確に示すためです。

また、関数の中での変数の宣言はできるだけ避けるべきです。

関数の中で変数を宣言する必要がある場合は、

変数の宣言と同時に変数の初期化を行うべきです。

### 命名規則

変数・関数の名前はわかりやすいものにするべきです。

慣例として一般的に通じる変数・関数名(init や dmp等)を除き、

単語を省略した変数・関数名は認めません。

また、変数名は原則小文字と数字のみです。

変数名に複数の単語を使用する場合、

単語と単語の間にアンダーバー等を用いず、

二つ目以降の単語の頭文字を大文字にする必要があります。

また、すべての変数・関数の役割をプログラムフォルダ内の

variable-function.txtに記述する必要があります。

### 配列

ボールセンサやラインセンサなど共通性のある変数は、

配列にまとめるべきです。

この場合、配列は[0]から使い始める必要があります。

これは、メモリ不足を防ぐためと意図しないアクセスを防ぐためです。

また、配列に格納される値の使い方は統一しなければなりません。

（これは、[0]だけ別の使い方をすることは認めないということです。）

### 引数

関数の引数を省略して記述することは認められません。

これは、引数なし（void）である場合でも、

記述する必要があることを示しています。

### スコープ

変数をむやみにpublic:に記述することは好ましくありません。

意図しないアクセスが生じた場合、デバッグすることが困難なためです。

できるだけprivate:に記述し、必要な場合のみpublic:に記述しましょう。

### タイマ変数

タイマー変数の型はunsigned long(符号なしlong)を使うべきです。

これは、タイマーを返す関数（millis()等）の戻り値の型が

unsigned longであるためです。

### ポインタ変数

関数に配列を渡す場合、高速化のためポインタを用いるべきです。

ポインタ変数の宣言時につくアスタリスク（*）は、

変数名ではなく、型につけるようにしましょう。

> **注意点：** アスタリスクと型名と変数名の間すべてにスペースを入れないよう
> 注意してください。

## goto文について

goto文は一般的にプログラムの流れが分かりにくくなるためあまり使われません。

しかし、goto文を利用したほうがプログラムがスマートになる場合があります。

例として、2重forから抜け出す場合などから抜け出す場合が挙げられます。

goto文を使用するのは禁止はしませんが、

必要以上にgoto文を使わないことを強く推奨します。

## ループと条件式

if文やwhile文はその中の内容が一行で済む場合、

波かっこを使用しなくても記述できてしまいます。

しかし、これは階層構造が分かりにくいため、

波かっこを使って囲うべきです。

また波かっこで囲った箇所を、インデントすべきです。

for文のカウンタ変数は、for文の中で宣言し、

その変数名にはi、j、kのみを使用することができます。

また、特別な理由がない場合はカウンタ変数は0に初期化し、

カウントアップしていく方式をとるべきです。

理由として、何回ループするのかを書き手に

明確に伝える目的にあります。

## 既存のコード

このコーディング規則を満たしていない既存のコードを使用する場合、

できるだけ、この規則に合うように修正すべきです。

ただし、その修正によって、コードの信頼性が低下する場合、

コードの修正はするべきではありません。

## フォーマット

プログラムは、保存する前にフォーマットするべきです。

フォーマットスタイルはChromiumで統一します。

これは、ArduinoIDEのフォーマットに近くどちらの環境でも編集しやすいのと、

フォーマットスタイルの違いによる不必要なコミットを防ぐためです。

また、処理の類が異なる類に切り替わるとき、

一行の改行でここで処理が切り替わることを明確に示すべきです。